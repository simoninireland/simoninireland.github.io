<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simon Dobson (old posts, page 147)</title>
<style>
	@font-face {
	    font-family: "libretto-icons";
	    src:url(../assets/fonts/libretto-icons.eot);
	    src:url(../assets/fonts/libretto-icons.eot#iefix) format("embedded-opentype"),
	    url(../assets/fonts/libretto-icons.woff) format("woff"),
	    url(../assets/fonts/libretto-icons.ttf) format("truetype"),
	    url(../assets/fonts/libretto-icons.svg#libretto-icons) format("svg");
	    font-weight: normal;
	    font-style: normal;
	}
    </style>
<link rel="icon" href="../images/favicon.png" sizes="16x16">
<link rel="alternate" type="application/rss+xml" href="../rss.xml">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Sans+Mono|Libre+Baskerville|Montserrat|Playfair+Display|Tangerine">
<link rel="stylesheet" href="../assets/css/libretto_styles.css">
<link rel="stylesheet" href="../assets/css/baguetteBox.min.css">
<link rel="stylesheet" href="../assets/css/code.css">
<link rel="stylesheet" href="../assets/css/nikola_rst.css">
<link rel="stylesheet" href="../assets/css/nikola_ipython.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
</head>
<body>
    <!-- Navigation bar -->
    <header class="nav-bar"><div class="site-branding">
	    <h1 class="site-title">
		<a href="https://simondobson.org/" title="Simon Dobson" rel="home">Simon&nbsp;Dobson</a>
	    </h1>
	</div>
	<nav class="site-navigation" role="navigation"><div class="menu-toggle">
		<span class="mobile-site-title">Simon Dobson</span>
	    </div>
	    <ul class="menu">
<li><a href="../index.html">Home</a></li>
		    <li><a href="../personal/">About&nbsp;me</a></li>
		    <li><a href="../research/">Research</a></li>
		    <li><a href="../development/projects/">Software</a></li>
		    <li><a href="../writing/">Writing</a></li>
		    <li><a href="../personal/contact/">Contact</a></li>
		<li>
<a href="../rss.xml"><i class="fa fa-rss"></i></a>
	    </li>
</ul></nav></header><div class="site-content">
	    <article class="format-standard libretto-long-form"><div class="title-block post-format-icon-pin">
		    <div class="entry-meta">
			<span class="posted-on">
			    Posted on <a href="../2024/07/05/let-over-lambda/" rel="bookmark">Friday 5 July, 2024</a>
			</span>
		    </div>
		    <h1><a href="../2024/07/05/let-over-lambda/">Let over&nbsp;Lambda</a></h1>
		</div>
		<div class="entry-content">
			<div id="outline-container-orgfbf54c4" class="outline-2">
<h2 id="orgfbf54c4">Let over&nbsp;Lambda</h2>
<div class="outline-text-2" id="text-orgfbf54c4">
<p>
Doug Hoyte.  <i><a href="http://letoverlambda.com">Let over Lambda</a></i>. <span class="caps">HCSW</span> and Hoytech. <span class="caps">ISBN</span>
978-1-4357-1275-1.&nbsp;2008.
</p>

<p>
A gloriously opinionated (in the best way) take on Lisp macro
programming. The author treats Lisp – one of the first languages
– as the ultimate, <i>final</i> language to which all others can (and
should) be translated, since they&#8217;re simply special cases of Lisp
forms. And he makes a surprisingly compelling&nbsp;case.
</p>

<p>
The material builds extensively on <a href="/2024/07/05/on-lisp/">On Lisp</a>, re-presenting the
idea of <i>anaphoric</i> macros (those that bind lexical variables for
use in their bodies) and extending them with <i>pandoric</i> macros
that allow introspection into an otherwise closed lexical
environment. A lot of these examples feel contrived as presented,
but the techniques are anything but: powerful ways to build&nbsp;abstractions.
</p>

<p>
The finale is the implementation of Forth in Lisp, and then a
reflection to allow Forth programs to define Lisp functions –
converting a (transparent) threaded-interpreted structure into an
(opaque) code block. It&#8217;s a slightly non-standard Forth, but it&#8217;s
true to the basics and exposes issues like the implementations of
interpretation, compilation, and tail recursion really well. It&#8217;s
only another step to explore Lisp <i>implemented</i> in Forth through
the medium of macro programming, which deserves a book&nbsp;itself.
</p>
</div>
</div>
		</div>
	    </article>
</div>
	<div class="site-content">
	    <article class="format-standard libretto-long-form"><div class="title-block post-format-icon-pin">
		    <div class="entry-meta">
			<span class="posted-on">
			    Posted on <a href="../2024/07/05/on-lisp/" rel="bookmark">Friday 5 July, 2024</a>
			</span>
		    </div>
		    <h1><a href="../2024/07/05/on-lisp/">On&nbsp;Lisp</a></h1>
		</div>
		<div class="entry-content">
			<div id="outline-container-orgaac5f5f" class="outline-2">
<h2 id="orgaac5f5f">On&nbsp;Lisp</h2>
<div class="outline-text-2" id="text-orgaac5f5f">
<p>
Paul Graham.  <i><a href="http://www.paulgraham.com/onlisp.html">On Lisp: Advanced Techniques for Common Lisp</a></i>. Prentice
Hall. <span class="caps">ISBN</span> 0-13-030552-9.&nbsp;1993.
</p>

<blockquote>
<p>
An ideal world is left as an exercise to the&nbsp;reader.
</p>
</blockquote>

<p>
One of the most famous advanced treatments of Lisp. Essentially
it&#8217;s a book in two parts. The first deals with the traditional
advanced topics of functional programming such as identifying
patterns that can be factored-out into higher-order functions and
re-used. But the second, better-known, part deals with macro
programming in extraordinary detail and with enormous creativity,
including developing macros for continuations and several embedded&nbsp;languages.
</p>
</div>
</div>
		</div>
	    </article>
</div>
	<div class="site-content">
	    <article class="format-standard libretto-long-form"><div class="title-block post-format-icon-pin">
		    <div class="entry-meta">
			<span class="posted-on">
			    Posted on <a href="../2024/07/05/debugging-lisp/" rel="bookmark">Friday 5 July, 2024</a>
			</span>
		    </div>
		    <h1><a href="../2024/07/05/debugging-lisp/">Debugging&nbsp;Lisp</a></h1>
		</div>
		<div class="entry-content">
			<div id="outline-container-orgb9a4deb" class="outline-2">
<h2 id="orgb9a4deb">Debugging&nbsp;Lisp</h2>
<div class="outline-text-2" id="text-orgb9a4deb">
<p>
<a href="https://malisper.me/debugging-lisp-part-1-recompilation/">Debugging&nbsp;Lisp</a>
</p>

<p>
A four-part blog post series on debugging Lisp,&nbsp;covering:
</p>

<ol class="org-ol">
<li>Live recompilation of code from inside a debugging session,
together with re-executing changed code from within a running
stack&nbsp;trace</li>
<li>Inspecting objects and interacting with traces of function&nbsp;calls</li>
<li>Redefining classes, and how to ensure that existing instances
are upgraded to be compatible with the new&nbsp;definition</li>
<li>Restarts, the neglected part of the condition system that
controls how programs continue after encountering&nbsp;errors</li>
</ol>
<p>
The first two are essential, and show how <i>different</i> Lisp
programming is from using other languages. In fact it requires a
considerable mental shift to re-acquire the right reflexes for
dealing with errors and debugging in a fully interactive
environment: well, it did for me, anyway. We&#8217;re not used to
interactivity in large development environments. There is seldom
any need to close down a running Lisp session and start again, as
everything can usually be changed and adapted within a session.
This is very unlike the usual compile-edit-debug cycles we&#8217;ve
become accustomed&nbsp;to.
</p>

<p>
The third post – on redefining classes – shows how one can
upgrade a program that simply <i>has</i> to keep running, because its
live state upgrade can be programmed&nbsp;too.
</p>

<p>
The most significant part of the mental shift is to realise that
the debugger is written in Lisp itself, and makes use of restarts
and other features to provide the interface. This is a consequence
of the degree of exposure of the Lisp run-time structures into to
language itself, where they can be examined and manipulated using
the full power of the language – and then be re-started or
discarded as&nbsp;required.
</p>
</div>
</div>
		</div>
	    </article>
</div>
	<div class="site-content">
	    <article class="format-standard libretto-long-form"><div class="title-block post-format-icon-pin">
		    <div class="entry-meta">
			<span class="posted-on">
			    Posted on <a href="../goodreads/ultra-processed-people-the-science-behind-food-that-isnt-food/" rel="bookmark">Thursday 4 July, 2024</a>
			</span>
		    </div>
		    <h1><a href="../goodreads/ultra-processed-people-the-science-behind-food-that-isnt-food/">Ultra-Processed People: The Science Behind Food That Isn&#8217;t&nbsp;Food</a></h1>
		</div>
		<div class="entry-content">
			<div>
    <div>
      <img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1679715862l/62586003._SX98_.jpg" style="float: left; margin-right: 10px"><h2>
	Chris van Tulleken&nbsp;(2023)
      </h2>
    </div>
    <p>
      Food <i>versus</i> food-shaped industrial products.<br><br>Ultra-processed food (<span class="caps">UPF</span>) is pervasive in modern diets, and with it comes a litany of actual, conjectured, and supposed harms. <span class="caps">UPF</span> itself is a strange beast, taking food crops and turning them into pure components that can then be re-mixed to construct new products. This has some perverse consequences, such as flavours being removed from purified and &#8220;modified&#8221; oils and starches in order to make them more broadly usable – and then having <i>those same flavours</i> re-introduced later in the process, again in &#8220;modified&#8221; form. That sounds insane – how can it be cheaper than using the original oil? – but in fact it makes perfet commercial sense for companies wanting fungible raw materials to produce unvarying, known-ahead-of-time tastes and textures. <br><br>The resulting products (I&#8217;m now reluctant to call them foods), being created in labs, can be re-worked in pursuit of particular commercial goals, for example by adding powdered soya when looking to create a &#8220;high-protein&#8221; snack. They can also be re-engineered to be far more pleasurable and addictive for consumers, for example by hacking the body&#8217;s responses to food (which are themselves coming to be understood as far more subtle and complicated than we used to think).<br><br>van Tulleken has a science background, and it shows in the writing: most of the claims are carefully framed and evidenced. His background also saves him from falling for the industry&#8217;s faux-refutations about there not being definitive causal links to specific harms: randomised controlled trials <i>aren&#8217;t</i> the &#8220;scientific gold standard&#8221; in situations where they&#8217;re impossible to conduct in the real world, and epidemiological evidence coupled with some knowledge of the possible harm pathways can provide sufficient evidence. Having said that, he does sometimes deviate from this careful path, and there are a few instances of words like &#8220;may&#8221; and &#8220;could&#8221; doing a lot of heavy lifting.<br><br>One of the most powerful elements of the book is that it simultaneously doesn&#8217;t preach or prescribe, but does offer suggestions for ways forward. <span class="caps">UPF</span> is very difficult to precisely define, and is therefore difficult to legislate for or avoid. Does a single stabiliser in a product render it <span class="caps">UPF</span>? – because if so literally <i>anything in a packet</i> would be included. van Tulleken also takes aim at some of the wider social drivers of <span class="caps">UPF</span>, notably its cheapness and ease of preparation compared to &#8220;real&#8221; food, reinforcing poor diet as a consequence of poverty. He also suggests some interesting policy options, while also taking aim at a policy infrastructure that&#8217;s heavily co-opted by the <span class="caps">UPF</span> industry. Regulators and the food industry are <i>not</i> partners and have goals that are mutually irreconcilable within the current framework of pre-eminent shareholder&nbsp;value.
      </p>
<p>
	5/5.
	  Finished Thursday 4 July,&nbsp;2024.
	</p>
<p>
	  (Originally published on <a href="https://www.goodreads.com/review/show/6565805510?utm_medium=api&amp;utm_source=rss">Goodreads</a>.)
  </p>
</div>
		</div>
	    </article>
</div>
	<div class="site-content">
	    <article class="format-standard libretto-long-form"><div class="title-block post-format-icon-pin">
		    <div class="entry-meta">
			<span class="posted-on">
			    Posted on <a href="../2024/06/28/class-slots-that-work-with-classes-and-instances-in-clos/" rel="bookmark">Friday 28 June, 2024</a>
			</span>
		    </div>
		    <h1><a href="../2024/06/28/class-slots-that-work-with-classes-and-instances-in-clos/">Class slots that work with classes and instances in&nbsp;<span class="caps">CLOS</span></a></h1>
		</div>
		<div class="entry-content">
			<div id="outline-container-orgf8dcbd0" class="outline-2">
<h2 id="orgf8dcbd0">Class slots that work with classes and instances in&nbsp;<span class="caps">CLOS</span></h2>
<div class="outline-text-2" id="text-orgf8dcbd0">
<p>
I recently had a use case where I wanted to associate a constant
value with a class <i>and</i> its instances – but I needed to be able to
get the value without having an instance to hand. This turns out
to be solvable in&nbsp;<span class="caps">CLOS</span>.
</p>

<p>
In languages like Java you can associate class variables with
classes, which can then be accessed without having an instance of
the class. <span class="caps">CLOS</span> also has class-allocated slots, for&nbsp;example:
</p>

<div class="highlight"><pre><span></span><span class="w">    </span><span class="p">(</span><span class="nb">defclass</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="p">()</span>
<span class="w">      </span><span class="p">((</span><span class="nv">instance-slot</span>
<span class="w">        </span><span class="ss">:initform</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">       </span><span class="p">(</span><span class="nv">class-slot</span>
<span class="w">        </span><span class="ss">:allocation</span><span class="w"> </span><span class="ss">:class</span>
<span class="w">        </span><span class="ss">:initform</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="ss">:documentation</span><span class="w"> </span><span class="s">"A class with instance- and class-allocated slots."</span><span class="p">))</span>
</pre></div>

<p>
An instance&nbsp;of <code>A</code> has two&nbsp;slots: <code>instance-slot</code> stored per-instance,&nbsp;and <code>class-slot</code> stored only once and shared amongst all instances.
This is close to Java&#8217;s notion of class variables, but one still
needs an instance against which to call the method. (Seibel makes
this point in <a href="https://gigamonkeys.com/book/object-reorientation-classes">chapter 17 of &#8220;Practical Common Lisp&#8221;</a>.)
</p>

<p>
One could just create a basic object and retrieve the&nbsp;slot:
</p>

<div class="highlight"><pre><span></span><span class="w"> </span><span class="p">(</span><span class="nb">slot-value</span><span class="w"> </span><span class="p">(</span><span class="nb">make-instance</span><span class="w"> </span><span class="ss">'A</span><span class="p">)</span><span class="w"> </span><span class="ss">'class-slot</span><span class="p">)</span>
</pre></div>

<p>
but that&#8217;s inelegant and could potentially trigger a lot of
unnecessary execution (and errors) if there are constructors&nbsp;(overridden <code>initialize-instance</code> methods)&nbsp;for <code>A</code>. One could use the
metaobject protocol to introspect on the slot, but that&#8217;s quite
involved and still allows the slot to be changed, which isn&#8217;t part
of this use&nbsp;case.
</p>

<p>
What I really want is to be able to define a generic function such&nbsp;as <code>class-slot</code> – but specialised against the <i>class</i> <code>A</code> rather than
against the <i>instances</i>&nbsp;of <code>A</code>. I thought this would need a metaclass
to define the method on, but it turned out that generic functions
are powerful enough on their&nbsp;own.
</p>

<p>
The trick is to first define a generic&nbsp;method:
</p>

<div class="highlight"><pre><span></span><span class="w">    </span><span class="p">(</span><span class="nb">defgeneric</span><span class="w"> </span><span class="nv">class-slot</span><span class="w"> </span><span class="p">(</span><span class="nv">classname</span><span class="p">)</span>
<span class="w">      </span><span class="s">"Access the class slot on class."</span><span class="p">)</span>
</pre></div>

<p>
As the argument name suggests, we&#8217;re planning on passing a class
name to this method, not an instance. To set the value&nbsp;for <code>A</code>, we
specialise the method as working on exactly the class&nbsp;A:
</p>

<div class="highlight"><pre><span></span><span class="w">    </span><span class="p">(</span><span class="nb">defmethod</span><span class="w"> </span><span class="nv">class-slot</span><span class="w"> </span><span class="p">((</span><span class="nv">classname</span><span class="w"> </span><span class="p">(</span><span class="nb">eql</span><span class="w"> </span><span class="ss">'A</span><span class="p">)))</span>
<span class="w">      </span><span class="mi">2</span><span class="p">)</span>
</pre></div>

<p>
The <code>eql</code> specialiser selects this method only when exactly this
object is passed in – that is to say, the name&nbsp;of <code>A</code>.
</p>

<p>
But what if we have an <i>instance</i>&nbsp;of <code>A</code>? The same generic function
can still be used, but instead we specialise it against objects
of&nbsp;class <code>A</code> in the usual&nbsp;way:
</p>

<div class="highlight"><pre><span></span><span class="w">    </span><span class="p">(</span><span class="nb">defmethod</span><span class="w"> </span><span class="nv">class-slot</span><span class="w"> </span><span class="p">((</span><span class="nv">a</span><span class="w"> </span><span class="nv">A</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="nv">class-slot</span><span class="w"> </span><span class="p">(</span><span class="nb">class-name</span><span class="w"> </span><span class="p">(</span><span class="nb">class-of</span><span class="w"> </span><span class="nv">a</span><span class="p">))))</span>
</pre></div>

<p>
If we now pass an instance&nbsp;of <code>A</code>, we extract its class name and then
re-call the <i>same</i> generic function, passing it the class name
instead of the object itself (which it doesn&#8217;t need, because the
slot value is independent of the actual object). This will select
the correct specialisation and return the slot&nbsp;value.
</p>

<p>
This approach works if we generate sub-classes&nbsp;of <code>A</code>: we just&nbsp;use
<code>eql</code> to specialise the generic function to the class we&#8217;re
interested in. It also works fine with packages, since the
undecorated symbol passed to the specialiser will be expanded
correctly according to what symbols are in scope. However, the
value is <i>only</i> associated with a single class, and isn&#8217;t inherited.
That&#8217;s not a massive limitation for my current use case, but would
be in general, I&nbsp;think.
</p>

<p>
This approach critically relies on an easily-forgotten property of
Lisp: <i>values</i> have types, but <i>variables</i> don&#8217;t, and we can
specialise the <i>same</i> generic function against <i>any</i> value <i>or</i> type.
The pattern makes use of this to avoid actually storing the value&nbsp;of <code>class-slot</code> anywhere, which as a side effect avoids the problem
of someone accidentally assigning a new value to it. It&#8217;s an
example of how powerful generic functions are: more so than the
method tables and messages found in most O-O languages. And it&#8217;s
sufficiently structured that it&#8217;s crying-out for a couple of
macros to define these kinds of class&nbsp;slots.
</p>

<p>
<span class="caps">UPDATED</span> 2024-06-29: Fixed the typo in the class definition to&nbsp;use
<code>:initform</code> and&nbsp;not <code>:initarg</code>. Thanks to <a href="https://framapiaf.org/@vindarel">@vindarel</a> for pointing this
out to&nbsp;me.
</p>
</div>
</div>
		</div>
	    </article>
</div>
    <!-- Lower Navigation links -->
    <nav class="site-content navigation-post" role="navigation"><div class="previous">
		<a href="index-146.html" rel="prev">
		    <span class="meta-nav">Older Entries</span>		</a>
	    </div>
	    <div class="next">
		<a href="index-148.html" rel="next">
		    <span class="meta-nav">Newer Entries</span>		</a>
	    </div>
    </nav><!-- Page Footer --><section class="footer-sidebar clear" role="complementary"><div class="widget-block">
	    <aside class="widget"><h2 class="widget-title">Simon&nbsp;Dobson</h2>
		<div class="widget-text">Aut tace aut loquere meliora silentio</div>
	    </aside>
</div>
    </section><!-- Extra JavaScript --><!-- Site Attributions --><footer class="site-footer" role="contentinfo"><div class="site-info">
	    <p></p>
	    <p>
	      Built with free and open-source software.
	      Powered by <a href="https://getnikola.com/">Nikola</a> using a theme based on
	      <a href="https://themes.getnikola.com/v7/libretto/">Libretto</a>.
	    </p>
	    <p>
	      All content Copyright © 2010–2024 Simon Dobson and licensed under
	      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="caps">CC</span>-<span class="caps">BY</span>-<span class="caps">NC</span>-<span class="caps">SA</span>-4.0</a>
	      unless otherwise&nbsp;noted.
	    </p>
	</div>
	<div class="social">
	    <ul class="menu"></ul>
</div>
    </footer>
</body>
</html>