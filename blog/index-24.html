<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Aut tace aut loquere meliora silentio">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simon Dobson (old posts, page 24) | Simon Dobson</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://simondobson.org/blog/index-24.html">
<link rel="prev" href="index-25.html" type="text/html">
<link rel="next" href="index-23.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-10943215-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-10943215-1');
</script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../">

            <span id="blog-title">Simon Dobson</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../whats-happening/" class="nav-link">What's happening</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a>
            <div class="dropdown-menu">
                    <a href="../personal/about-me/" class="dropdown-item">Welcome</a>
                    <a href="../personal/biography/" class="dropdown-item">Biography</a>
                    <a href="../personal/contact/" class="dropdown-item">Contact</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Academic</a>
            <div class="dropdown-menu">
                    <a href="../research/research-interests/" class="dropdown-item">Current interests</a>
                    <a href="../research/current-group/" class="dropdown-item">Current group</a>
                    <a href="../research/publications/" class="dropdown-item">Publications</a>
                    <a href="../research/publications-by-year/" class="dropdown-item">Publications by year</a>
                    <a href="../research/bibliometrics/" class="dropdown-item">Bibliometrics</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Writing</a>
            <div class="dropdown-menu">
                    <a href="../writing/essays/" class="dropdown-item">Essays</a>
                    <a href="../writing/em-book/" class="dropdown-item">Epidemic modelling -- Some notes, maths, and code</a>
                    <a href="../writing/cncp-book/" class="dropdown-item">Complex networks, complex processes</a>
                    <a href="../writing/book-reviews" class="dropdown-item">Book reviews</a>
                    <a href="../categories/" class="dropdown-item">Articles by topic</a>
                    <a href="../archive.html" class="dropdown-item">Article by date</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Current projects</a>
            <div class="dropdown-menu">
                    <a href="../development/epyc/" class="dropdown-item">epyc</a>
                    <a href="../development/epydemic/" class="dropdown-item">epydemic</a>
                    <a href="../development/simplicial/" class="dropdown-item">simplicial</a>
                    <a href="../galleries/" class="dropdown-item">Photography</a>
            </div>
                </li>
<li class="nav-item">
<a href="../old-projects/" class="nav-link">Older projects</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
    
    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="goodreads/the-war-of-the-world/" class="u-url">The War of the World</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="goodreads/the-war-of-the-world/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-21T02:52:22-07:00" itemprop="datePublished" title="2013-08-21 02:52">2013-08-21 02:52</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
	<div>
		<div>
			<img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1469977523l/603423._SX98_.jpg" style="float: left; margin-right: 10px"><div>
				<h2>Niall Ferguson</h2>
				   2006
				<p>
				</p>
<hr>
</div>
		</div>
		<p>
		
		</p>
<p>
		   Finished on Wed, 21 Aug 2013 02:52:22 -0700.  
		Rating 4/5.
	</p>
</div>
   </div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/08/18/ambient-backscatter/" class="u-url">Ambient backscatter</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/08/18/ambient-backscatter/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-18T13:14:54+01:00" itemprop="datePublished" title="2013-08-18 13:14">2013-08-18 13:14</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>An interesting article on how to power sensors and other "Internet of Things" devices.</p>
<!--more-->

<p>A group at the University of Washington has developed a way of making use of "stray" radiation to power simple radio transmitters and receivers. Rather than use a dedicated power source, whether on-board like a battery or transmitted as in near-field communications, this technique makes use of the ambient radiation of cellphone signals, wifi networks and the like to provide enough power to energise a simple radio link.</p>
<p><a href="http://makezine.com/2013/08/14/ambient-backscatter/" target="_blank">Recycled Energy: Ambient Backscatter Allows Wireless Communications with no Batteries</a></p>
<p>If it works reliably, this'll be a huge contribution to low-power environmental sensing as well as to the applications the authors are targeting.</p>
<p></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/08/18/abstracts/" class="u-url">How to write an abstract</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/08/18/abstracts/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-18T13:03:53+01:00" itemprop="datePublished" title="2013-08-18 13:03">2013-08-18 13:03</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>An abstract is an advertisement, not an introduction.</p>
<!--more-->

<p>I've spent much of this week working with MSc students writing their dissertations, and this has inevitably led to the part of a dissertation that often causes the most pain to write (and read, for that matter): the abstract.</p>
<p>What is the abstract of a report or paper? What it <em>isn't</em> is an introduction or guide to the rest of the document: that, unsurprisingly, is what the introduction is for. The goal of an abstract is much simpler: it's intended to persuade the reader to read some or all of the rest of the document. It may be surprising that this is an issue, but in a world in the grip of an information explosion it's clear that readers' attention is a limiting quantity in information processing. As a reader, should you bother to read a paper? Or not? And how do you make this decision?</p>
<p>Many new researchers, when confronted with a paper, start at the front and work forward. More experienced researchers know this is a mistake that leads to reading whole tracts of irrelevance or nonsense. (The former is worse: nonsense at least has occasional entertainment value.) This leads many people (myself included) to adopt a non-linear reading style:
</p>
<ol>
<li>Read the abstract</li>
    <li>If still interested, read the conclusion</li>
    <li>If <em>still</em> interested, read the introduction</li>
    <li>If it's <em>really</em> interesting, read the rest of the paper</li>
</ol>
(There are several variants, a couple of which are described <a href="http://www.sciencebuddies.org/science-fair-projects/top_science-fair_how_to_read_a_scientific_paper.shtml" target="_blank">here</a> and <a href="http://www.wikihow.com/Read-a-Scientific-Paper" target="_blank">here</a>.) The point here is that we can filter out papers of lesser interest to reserve time and head space for the most interesting. Only if the results grab your attention do you need to spend time discovering the detail of how they were obtained -- rather than doing that work only discover that you don't care about the results being reported.
<p>The abstract is the key: without a decent description of what the paper is about, the discerning reader will not proceed even to the introduction, and therefore any work contained in the paper will remain unread -- and therefore be largely worthless.</p>
<p>So how does one write a decent abstract? Most experienced scientists have their own technique, and the approach does need to vary from field to field and for different paper styles: a review paper is different to a piece of primary research. The approach I've come to rely on for research in computer science and mathematics can be described succinctly as <strong>the five-sentence abstract</strong>. I've found five sentences seems to be about optimal, structured as follows:</p>
<ul>
<li>
<span style="color: red">The area of the paper (1 sentence).</span> The problem area to which this paper makes a contribution.</li>
    <li>
<span style="color: orange">The issue the paper addresses (1 sentence).</span> Presumably the area is not yet fully explored, and you've found a problem that needs tackling -- otherwise what's in your paper?</li>
    <li>
<span style="color: green">What you've done, the results you've obtained (2 sentences).</span> The key contribution of the paper, what you've added to practice and/or knowledge</li>
    <li>
<span style="color: blue">What this means (1 sentence).</span> Why should anyone care?</li>
</ul>
<p>Let's do an example, from a paper I've always wanted to write about finding unicorns:</p>
<blockquote>
<span style="color: red">There are lots of interesting animals out there, many of which have horns.</span> <span style="color: orange">No-one has yet reported observing any one-horned horses, however.</span> <span style="color: green">We describe our research survey of the horses of the West of Ireland. While we found many horses, and many other horned animals, we failed to locate any horned horses.</span> <span style="color: blue">We conclude that further research is required to find unicorns, preferably in an equally pleasant holiday destination.</span>
</blockquote>
<p>OK, perhaps not a great example. Let's try another, from a real paper:</p>
<blockquote>
<span style="color: red">In the domain of ubiquitous computing, the ability to identify the occurrence of situations is a core function of being context-aware.</span> <span style="color: orange">Given the uncertain nature of sensor information and inference rules, reasoning techniques that cater for uncertainty hold promise for enhancing the reasoning process.</span> <span style="color: green">In our work, we apply the Dempster Shafer theory of evidence to infer situation occurrence with the minimal use of training data. We describe a set of evidential operations for sensor mass functions using context quality and evidence accumulation for continuous situation detection.</span> <span style="color: blue">We demonstrate how our approach enables situation inference with uncertain information using a case study based on a published smart home data set.</span>
</blockquote>
<p>(Taken from McKeever, Ye, Coyle and Dobson. <a href="http://www.simondobson.org/softcopy/ds-situation-inference-eurossc-09.pdf">Using Dempster-Shafer theory of evidence for situation inference</a>. In Proceedings of the 4th European Conference on Smart Sensing and Context (EuroSSC). Volume 5741 of LNCS. Springer-Verlag. Guildford, UK. 2009.) The abstract goes from domain to challenge to approach to significance: having read it, the reader hopefully has a fairly good idea of what the paper contributes to which domain, and why this contribution is significant (in the authors' minds, at least).</p>
<p>Shorter is often better, of course:</p>
<div title="Page 1">
<div>
<div>
<blockquote>
<span style="color: red">Wireless sensor networks are attracting increasing interest</span> <span style="color: orange">but suffer from severe challenges such as power constraints and low data reliability. Sensors are often energy-hungry and cannot operate over the long term, and the data they gather are frequently erroneous in complex ways. The two problems are linked, but existing work typically treats them independently:</span> <span style="color: green">in this paper we consider both side-by-side,</span> <span style="color: blue">and propose a self-organising solution for model-based data collection that reduces errors and communications in a unified fashion.</span>
</blockquote>
</div>
</div>
</div>
<p>(From Fang and Dobson. <a href="http://www.simondobson.org/softcopy/iwsos-faults-energy.pdf">Unifying sensor fault detection with energy conservation</a>. In Proceedings of the 7th International Workshop on Self-Organising Systems (IWSOS'13). Palma de Mallorca, ES. May 2013.) In this case my student Lei messed with the sentence structure because we wanted to get across the idea that the main problem was the totality of the existing approach to the problem, which we wanted to address as a whole. The abstract still follows the basic structure, and I think is stronger for being shorter.</p>
<p>No rule of writing is hard-and-fast, of course, and so you'll often find great abstracts that adopt a completely different approach. I don't think this matters so much as ensuring that the abstract is fit for purpose: an enticement to read further.</p>
<p></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="goodreads/who-got-einsteins-office-eccentricity-and-genius-at-the-institute-for-advanced-study/" class="u-url">Who Got Einstein's Office? Eccentricity and Genius at the Institute for Advanced Study</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="goodreads/who-got-einsteins-office-eccentricity-and-genius-at-the-institute-for-advanced-study/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-12T08:17:18-07:00" itemprop="datePublished" title="2013-08-12 08:17">2013-08-12 08:17</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
	<div>
		<div>
			<img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1347785661l/1088138._SX98_.jpg" style="float: left; margin-right: 10px"><div>
				<h2>Ed Regis</h2>
				   1987
				<p>
				</p>
<hr>
</div>
		</div>
		<p>
		Very enjoyable mixture of history, biography, and science, not to mention some great observations on the nature of research and the divisions between experimentalists and theorists.
		</p>
<p>
		   Finished on Mon, 12 Aug 2013 08:17:18 -0700.  
		Rating 4/5.
	</p>
</div>
   </div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="goodreads/measurement/" class="u-url">Measurement</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="goodreads/measurement/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-05T08:33:39-07:00" itemprop="datePublished" title="2013-08-05 08:33">2013-08-05 08:33</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
	<div>
		<div>
			<img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1339433761l/15701297._SX98_.jpg" style="float: left; margin-right: 10px"><div>
				<h2>Paul  Lockhart</h2>
				   2012
				<p>
				</p>
<hr>
</div>
		</div>
		<p>
		This is a quite phenomenal tour de force by a talented and enthusiastic mathematician keen to break down the mystique and barriers to the subject. He does do spectacularly well: this little volume covers an amazing amount of ground, from simple measurement concepts and problem-solving all the way up to the ideas that underlie some of the most modern pieces of mathematics like differential forms and the calculus of variations. On the way everyone will learn something they didn't know, in my case the relationship between natural logarithms and conic sections.
		</p>
<p>
		   Finished on Mon, 05 Aug 2013 08:33:39 -0700.  
		Rating 5/5.
	</p>
</div>
   </div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="goodreads/the-korean-war-pan-military-classics/" class="u-url">The Korean War (Pan Military Classics)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="goodreads/the-korean-war-pan-military-classics/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-05T08:28:44-07:00" itemprop="datePublished" title="2013-08-05 08:28">2013-08-05 08:28</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
	<div>
		<div>
			<img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356137981l/8175905._SX98_.jpg" style="float: left; margin-right: 10px"><div>
				<h2>Max Hastings</h2>
				   1987
				<p>
				</p>
<hr>
</div>
		</div>
		<p>
		
		</p>
<p>
		   Finished on Mon, 05 Aug 2013 08:28:44 -0700.  
		Rating 4/5.
	</p>
</div>
   </div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="goodreads/inside-hitlers-bunker-the-last-days-of-the-third-reich/" class="u-url">Inside Hitler's Bunker: The Last Days of the Third Reich</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="goodreads/inside-hitlers-bunker-the-last-days-of-the-third-reich/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-05T08:12:50-07:00" itemprop="datePublished" title="2013-08-05 08:12">2013-08-05 08:12</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
	<div>
		<div>
			<img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1316635681l/93998._SX98_.jpg" style="float: left; margin-right: 10px"><div>
				<h2>Joachim Fest</h2>
				   2002
				<p>
				</p>
<hr>
</div>
		</div>
		<p>
		This is the book on which the film "Downfall"was largely based, and is I think the only treatment of these events by a German author. Fest exposes a lot of the research and interpretation that's happened since the other, classic histories were written, and gives a very insightful analysis of how the bunker doors into the context of Hitler's life and the end of the Third Reich. Well worth a read
		</p>
<p>
		   Finished on Mon, 05 Aug 2013 08:12:50 -0700.  
		Rating 4/5.
	</p>
</div>
   </div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/08/02/xbee-sleeping/" class="u-url">XBee sleeping</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/08/02/xbee-sleeping/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-02T15:41:30+01:00" itemprop="datePublished" title="2013-08-02 15:41">2013-08-02 15:41</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Clearly saving battery power means getting the XBee radio to sleep at the behest of the Arduino. This turns out to be fairly simple, but does require modifying the XBee shield slightly.</p>
<!--more-->

<p>Our <a href="2013/07/31/power/">previous measurements</a> indicate that the XBee draws about 45mA of current -- something we have to save for battery-powered nodes. Fortunately XBee radios have a hardware-controlled sleep mode, so the Arduino can sleep the radio when not in use.</p>
<p>Since XBees work as a <a href="2013/07/02/mesh-network/">mesh network</a>, it's clearly going to be an issue as to <em>when</em> a radio sleeps, and for how long -- since when asleep the radio can't route packets, and so the network starts to break down. But that's a higher-level concern: for the moment, we'll focus on the mechanics of getting the XBee to sleep.</p>
<p><img alt="Pins relating to XBee sleep mode" src="../images/citizen-sensing/sleep-pin.jpg"></p>
<p>The basic mechanism is simple, and involves hardware and software. At the hardware level, the XBee uses pin 9 (shown in red right) as a control pin. This pin can be used to sleep the radio: setting it to 3,3V ("high" or "asserted") causes the radio to sleep; setting it to 0V ("low" or "deasserted") wakes the radio up. The XBee only takes account of the pin when in certain sleep modes, however: these are analogous to the <a href="2013/07/23/arduino-watchdog/">Arduino's sleep modes</a>. This is the software part: the XBee needs to be placed into the correct sleep mode, and can then be controlled from the Arduino.</p>
<p>Also note I/O line 7, pin 12 (in green): we'll come back to this later.</p>
<p>We'll deal with the hardware part first, and then the software.</p>
<h3>Getting access to the sleep pin</h3>

<p>The XBee shield doesn't connect the sleep pin to anything by default, so to control it we have to connect it. There are several ways we could do this, with the simplest being to solder a wire from the pan on pin 9 to an appropriate header on the shield, which is then connected to a digital pin on the Arduino. For simplicity we'll start with a wire that's long enough to reach <em>any</em> header: we'll actually plug it into the header for the Arduino's D7 pin.</p>
<p>There's a slight concern about voltage levels in this approach, as the
Arduino operates at 5V while the XBee uses 3.3V. Experimentally this
doesn't seem to make a difference; for a production system we'd
probably want to create a resistor network to drop the voltage to that
needed by the radio, to avoid any risk of damage. We'd also probably
want to solder a header to XBee pin 9's pad to make it easier to
connect the wiring.</p>
<h3>Setting the sleep mode</h3>

<p>The XBee's sleep mode is controlled by a single AT command called (unsurprisingly) SM. The default (SM 0) is for the radio to be on all the time; SM 1 selects the pin-sleep mode described above, and is the one we'll be using as it places the radio under the (hardware) control of the Arduino. (There are other sleep modes where the radio sleeps under the control of its own internal timer. Some projects use the radio's timer to wake the Arduino rather than the other way round: we prefer to keep the Arduino in control.)</p>
<p>Setting the sleep mode is simply a matter of <a href="2013/08/02/at-commands-2">issuing the appropriate AT command</a>. However, as with a lot of things to do with hardware, we have to set things up slightly first.</p>
<p>The first issue concerns the setting of the XBee's sleep pin. If we
select pin-sleep mode with the pin high, the XBee will sleep
immediately, which might not be what we intended. So if we've
connected the sleep pin to D7, we need to set things up so that the
pin is low to keep the radio awake, and then select its sleep mode:</p>
<pre class="code literal-block"><span></span><code><span class="cp">#define XBEE_SLEEP 7                </span><span class="c1">// Xbee sleep pin on D7</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="n">pinMode</span><span class="p">(</span><span class="n">XBEE_SLEEP</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>     <span class="c1">// sleep control</span>
   <span class="n">digitalWrite</span><span class="p">(</span><span class="n">XBEE_SLEEP</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>   <span class="c1">// deassert to keep radio awake when sleep mode selected</span>
   <span class="p">...</span>
<span class="p">}</span>
</code></pre>

<p>(Some early mistakes showed that -- contrary to what might be expected -- the sleep pin defaults to high (send radio to sleep) rather than low. So this step is important.)</p>
<p>The next issue concerns the rather intricate behaviour of the XBee's other pins when sleeping. When the radio enters sleep mode, it asserts its I/O 7 line (pin 12) so that external devices know that it's asleep. This could be used to make sure that external peripherals wake up only when the radio is active, but for some reason the XBee shield's designers have connected this pin to the Arduino's reset line, which means that sleeping the radio will reset (and in fact freeze) the Arduino. <a href="http://rubenlaguna.com/wp/2009/03/05/setting-xbee-to-sleep-causes-arduino-reset/" target="_blank">Some posts suggest</a> that solving this requires cutting lines on the shield, which might have been true for earlier shields but now isn't: we simply need to disable the output of this pin, using another AT command:</p>
<pre class="code literal-block"><span></span><code><span class="n">atCommand</span><span class="p">(</span><span class="s">"D7"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</code></pre>

<p>This disables the XBee's D7 line (not to be confused with the Arduino's D7 line, which we've attached to the XBee's sleep pin), which is enough to stop the Arduino freezing. on sleep. (Yes, this <em>did</em> take quite a while to work out, since you ask...)</p>
<p>We can now put all this together to place the XBee into SM 1  and let the Arduino sleep it at will:</p>
<pre class="code literal-block"><span></span><code><span class="cp">#define LED 13</span>
<span class="cp">#define XBEE_SLEEP 7                </span><span class="c1">// XBee sleep pin on D7</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>            <span class="c1">// LED signal</span>
   <span class="n">pinMode</span><span class="p">(</span><span class="n">XBEE_SLEEP</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>     <span class="c1">// sleep control</span>
   <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
   <span class="n">radio</span><span class="p">.</span><span class="n">setSerial</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>

   <span class="n">digitalWrite</span><span class="p">(</span><span class="n">XBEE_SLEEP</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>   <span class="c1">// deassert to keep radio awake when sleep mode selected</span>
   <span class="k">if</span><span class="p">(</span><span class="n">atCommand</span><span class="p">(</span><span class="s">"D7"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">atCommand</span><span class="p">(</span><span class="s">"SM"</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// AT commands failed, flash frantically</span>
      <span class="p">...</span>
   <span class="p">}</span>
   <span class="p">...</span>
<span class="p">}</span>
</code></pre>

<p>Note that we've used local AT commands to set the radio's mode. It's
also possible to do this <a href="../2013/07/xctu/">statically using
X-CTU</a>.</p>
<h3>Results</h3>

<p><img alt="XBee with sleep control" src="../images/citizen-sensing/xbee-sleep.jpg"></p>
<p>The results of all this hacking are that the Arduino can put the XBee into sleep mode whenever it wants to simply by asserting D7. The voltages on pins are maintained even when the Arduino itself sleeps, so it can put the radio to sleep and then sleep itself, wake up and wake up the radio.</p>
<p>Measuring current shows that the sleeping Arduino and XBee draw abour 35mA, the same as an Arduino alone. This makes sense, as the XBee datasheet suggests that when sleeping it draws current in the microamp range -- far too small for a normal ammeter to measure, and dwarfed by the quiescent current of the Arduino board (which still needs some work).</p>
<p>Waking the radio happens quickly when the sleep pin is deasserted, but it seems to take some time to re-connect to the mesh co-ordinator: around 7s, in fact, which is a little strange and needs some more exploration.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/08/02/at-commands-2/" class="u-url">Issuing AT commands</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/08/02/at-commands-2/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-02T12:03:54+01:00" itemprop="datePublished" title="2013-08-02 12:03">2013-08-02 12:03</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Controlling the XBee requires issuing AT commands. The XBee library has the low-level machinery to do this.</p>
<!--more-->

<p>AT commands are the basis for controlling almost all modems, and the XBee is no different. In API mode, AT commands are issued in a similar manner to sending data. The Arduino XBee library has the low-level code needed, which can be wrapped into a slightly easier-to-use form.</p>
<p>The basic approach is to send an AT command request packet and then
read a returned packet acknowledging the command. For the moment we'll
stick to "setting" commands, where the AT command takes an integer
parameter: the other are needed less frequently. We construct the
request packet, send it, read the response, and check that all went
well. This isolates the rest of the program from the message exchange,
but also hides the exact nature of any error.</p>
<pre class="code literal-block"><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;XBee.h&gt;</span><span class="cp"></span>

<span class="n">XBee</span> <span class="n">radio</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">atCommand</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">command</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">param</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// send local AT command</span>
  <span class="n">AtCommandRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="n">AtCommandRequest</span><span class="p">((</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">command</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">param</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">));</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>

  <span class="c1">// receive response frame</span>
  <span class="n">AtCommandResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">AtCommandResponse</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">radio</span><span class="p">.</span><span class="n">readPacket</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span> <span class="p">{</span>                               <span class="c1">// read packet from radio</span>
     <span class="k">if</span><span class="p">(</span><span class="n">radio</span><span class="p">.</span><span class="n">getResponse</span><span class="p">().</span><span class="n">getApiId</span><span class="p">()</span> <span class="o">==</span> <span class="n">AT_RESPONSE</span><span class="p">)</span> <span class="p">{</span>    <span class="c1">// right type?</span>
       <span class="n">radio</span><span class="p">.</span><span class="n">getResponse</span><span class="p">().</span><span class="n">getAtCommandResponse</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">isOk</span><span class="p">())</span> <span class="p">{</span>                                     <span class="c1">// not an error?</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
       <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// if we get here, return a failure</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>

<p>This function can be used to issue the different control codes for the radio. Some parameters can be <a href="2013/07/02/xctu/">set using X-CTU </a>when the radio firmware is installed, but commands are sometimes needed at run-time too.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/31/power/" class="u-url">Basic power measurements</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/31/power/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-31T18:12:55+01:00" itemprop="datePublished" title="2013-07-31 18:12">2013-07-31 18:12</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Some initial measurements of power consumption.</p>
<!--more-->

<p>How much power does Arduino sleep mode save? The simplest way to work this out is to power an Arduino from a battery pack and measure the current being drawn in the different modes. A simple program to demonstrate the different modes is:
</p>
<ul>
<li>Normal <code>delay()</code> loop</li>
    <li>Deep sleep for a period (deep sleep)</li>
    <li>Flash the LED (awake)</li>
    <li>Flash the LED differently while sending out radio messages (awake and transmitting)</li>
</ul>
We perform these tasks repeatedly, keeping them going for 10s each to let the power draw stabilise.
<p>The results are as follows:</p>
<table style="border: 1"><tbody>
<tr>
<td>Activity</td>
<td>Power mode</td>
<td>Current</td>
</tr>
<tr>
<td>Nothing</td>
<td>
<code>delay()</code> loop</td>
<td>43mA</td>
</tr>
<tr>
<td>Nothing</td>
<td>Deep sleep</td>
<td>33mA</td>
</tr>
<tr>
<td>Steady LED</td>
<td>Deep sleep</td>
<td>34mA</td>
</tr>
<tr>
<td>Flashing LED</td>
<td>Awake</td>
<td>45mA</td>
</tr>
<tr>
<td>Xbee (quiet)</td>
<td>Deep sleep</td>
<td>72mA</td>
</tr>
<tr>
<td>Xbee (quiet)</td>
<td>Awake</td>
<td>85mA</td>
</tr>
<tr>
<td>Xbee (transmitting)</td>
<td>Awake</td>
<td>87mA</td>
</tr>
</tbody></table>
<p>The good news is that SleepySketch makes it very easy to access the deep sleep mode, and to stay in it by default. This is good, as the normal approach of using <code>delay()</code> is quite power-hungry. The bad news is that the "at rest" power consumption of an Arduino even in deep sleep  -- the quiescent current being drawn by the voltage regulator and other components on the board, regardless of what the microcontroller is doing -- is about 35mA, with an XBee drawing an additional 40mA.There is very little difference in power whether the radio is transmitting or not (although the current being drawn looked more variable when transmitting, suggesting that there's some variation happening faster than the ammeter's sample time).</p>
<p>The radio isn't put to sleep when the Arduino is asleep, which is clearly something that needs to happen: it draws power even when the Arduino is incapable of using it. Something to explore. Potentially more serious is the power being drawn when the Arduino is asleep. A battery pack with 4 x 1500mAH batteries will be drained in about 7 days (6000mAH / 35mA) even with the system asleep all the time.</p>
<p>[UPDATE 1Aug2013: made the table layout a bit clearer.]</p>
</div>
    </div>
    </article>
</div>
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-25.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-23.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content--><footer id="footer"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License CC-BY-NC-SA-4.0" style="border-width:0" src="../images/cc-by-nc-sa-4.0.png"></a>

            
        </footer>
</div>
</div>

        <script src="../assets/js/all-nocdn.js"></script><script src="https://polyfill.io/v3/polyfill.js?features=Intl.RelativeTimeFormat.%7Elocale.en"></script><script src="../assets/js/luxon.min.js"></script><!-- fancy dates --><script>
        luxon.Settings.defaultLocale = "en";
        fancydates(2, {"preset": false, "format": "yyyy-MM-dd HH:mm"});
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
