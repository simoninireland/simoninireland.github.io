<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Aut tace aut loquere meliora silentio">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simon Dobson (old posts, page 11) | Simon Dobson</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://simondobson.org/blog/index-11.html">
<link rel="prev" href="index-12.html" type="text/html">
<link rel="next" href="index-10.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-10943215-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-10943215-1');
</script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../">

            <span id="blog-title">Simon Dobson</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../whats-happening/" class="nav-link">What's happening</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a>
            <div class="dropdown-menu">
                    <a href="../personal/about-me/" class="dropdown-item">Welcome</a>
                    <a href="../personal/biography/" class="dropdown-item">Biography</a>
                    <a href="../personal/contact/" class="dropdown-item">Contact</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Academic</a>
            <div class="dropdown-menu">
                    <a href="../research/research-interests/" class="dropdown-item">Current interests</a>
                    <a href="../research/current-group/" class="dropdown-item">Current group</a>
                    <a href="../research/publications/" class="dropdown-item">Publications</a>
                    <a href="../research/publications-by-year/" class="dropdown-item">Publications by year</a>
                    <a href="../research/bibliometrics/" class="dropdown-item">Bibliometrics</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Writing</a>
            <div class="dropdown-menu">
                    <a href="../writing/essays/" class="dropdown-item">Essays</a>
                    <a href="../writing/em-book/" class="dropdown-item">Epidemic modelling -- Some notes, maths, and code</a>
                    <a href="../writing/cncp-book/" class="dropdown-item">Complex networks, complex processes</a>
                    <a href="../writing/book-reviews" class="dropdown-item">Book reviews</a>
                    <a href="../categories/" class="dropdown-item">Articles by topic</a>
                    <a href="../archive.html" class="dropdown-item">Article by date</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Current projects</a>
            <div class="dropdown-menu">
                    <a href="../development/epyc/" class="dropdown-item">epyc</a>
                    <a href="../development/epydemic/" class="dropdown-item">epydemic</a>
                    <a href="../development/simplicial/" class="dropdown-item">simplicial</a>
                    <a href="../galleries/" class="dropdown-item">Photography</a>
            </div>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Older projects</a>
            <div class="dropdown-menu">
                    <a href="../development/citizen-sensing/" class="dropdown-item">Citizen sensing with Arduino (2013)</a>
                    <a href="../development/sleepysketch/" class="dropdown-item">Arduino SleepySketch (2013--2014)</a>
                    <a href="../research/sapere/" class="dropdown-item">Sapere (2010--2013)</a>
                    <a href="../development/attila/" class="dropdown-item">Attila (2010--2013)</a>
                    <a href="../development/vanilla/" class="dropdown-item">Vanilla (1997-1999)</a>
            </div>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
    
    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/09/temperature-sensors-working/" class="u-url">Temperature sensors working</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/09/temperature-sensors-working/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-09T19:00:20+01:00" itemprop="datePublished" title="2013-07-09 19:00">2013-07-09 19:00</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>Temperature sensing using digital temperature sensors is easy to get working.</p>
<!--more-->

<p>The temperature sensing part of the project requires three sensors for ambient, high-up and low-down measurement. The <a href="2013/07/08/ds18b20/">DS18B20 temperature sensor </a>seems well-suited for the job.</p>
<p><img alt="DS18B20" src="../images/citizen-sensing/three-ds18b20.png"></p>
<p>Three DS18B20 temperature sensors sharing a OneWire bus, standard (rail) power mode</p>
<p>Hooking-up a OneWire bus for the three sensors lets them share a single microcontroller pin -- which isn't important for hardware reasons in this project, but also saves some microcontroller RAM, which might be. The circuit is very simple, with the three sensors sharing power and ground lines and with a common data line pulled-up to the power rail through a 4.7K resistor. The DQ line is attached to one of the Arduino's digital lines. The OneWire library is then used to instantiate a protocol handler for that line, and passed to the temperature control library to manage the interaction with the devices, including their conversion from raw to "real" temperature values.</p>
<p>The resulting code is almost comically simple:</p>
<pre class="code literal-block"><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;DallasTemperature.h&gt;</span><span class="cp"></span>

<span class="n">OneWire</span> <span class="nf">onewire</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>                  <span class="c1">// OneWire bus on pin 8</span>
<span class="n">DallasTemperature</span> <span class="nf">sensors</span><span class="p">(</span><span class="o">&amp;</span><span class="n">onewire</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">sensors</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sensors</span><span class="p">.</span><span class="n">requestTemperatures</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">c</span> <span class="o">-</span> <span class="n">sensors</span><span class="p">.</span><span class="n">getTempCByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sensor "</span><span class="p">);</span>   <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>   <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" = "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>   <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"C"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>

<p>That's it! The temperature library packages everything up nicely, including the conversion and the interaction with the OneWire protocol (which is quite fiddly).</p>
<p><img alt="Three DS18B30s on a prototyping shield" src="../images/citizen-sensing/ds18b20-prototype.jpg"></p>
<p>One potential problem for the future is that access to the sensors is by index, not by any particular identifier, and it;s not clear whether the ordering is always the same: does the sensor closest to the microcontroller always appear as index 0, for example? If not, then we'll have to identify which sensor is which somehow to sample the temperature from the correct place, or run each one on a different OneWire bus instance.</p>
<p>There's also an interesting point about parasite power mode, which is where the DS18B20 draws its power from the data bus rather than from a dedicated power rail. This might make power management easier, since the sensor would be unpowered when not being used, such as when the Arduino is asleep. This suggests it's probably worth looking into parasite power a bit more.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/08/ds18b20/" class="u-url">DS18B20 digital thermometer</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/08/ds18b20/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-08T20:22:02+01:00" itemprop="datePublished" title="2013-07-08 20:22">2013-07-08 20:22</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>The DS18B20 is a programmable digital thermometer that needs no calibration and uses only one wire of the microcontroller.</p>
<!--more-->

<p>The <a href="http://www.maximintegrated.com/datasheet/index.mvp/id/2812" target="_blank">DS18B20</a> is extremely popular as a temperature sensor, for obvious reasons: they're digital, and require no calibration, in contrast to using a thermistor or similar analogue device which would need to be characterised against reference temperatures. They're not as cheap as analogue components, but their simplicity of use and accuracy probably make up for that in scientific applications.</p>
<p>The devices are also notable as using the OneWire protocol developed by Dallas Semiconductor (now Maxim) and used in (amongst other devices) their <a href="http://www.maximintegrated.com/products/ibutton/" target="_blank">iButton</a> devices. Essentially <a href="https://en.wikipedia.org/wiki/1-Wire" target="_blank">OneWire</a> is an embedded systems equivalent of USB that allows a set of devices to be chained together and addressed using only one pin on a microcontroller. This means that there's no real limit on the number of sensors that even a small chip can make use of. The <a href="http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf" target="_blank">datasheet</a> is available if needed, but they're so easy to use and have such good software support (see below) that there's no real need to refer to it.</p>
<p>The sensors are packaged almost like transistors, with three wires for ground, power, and data. The easiest way to use them is to power them directly with 5V and ground, and use the third wire for communications. (There's also a "parasitic" mode that takes power from the data bus, which I haven't got to work yet.) The communications line is the "one wire" that runs the communications protocol.</p>
<p>Using OneWire devices, and DS18B20s in particular, is made very simple by the existence of two libraries, providing the <a href="http://www.pjrc.com/teensy/td_libs_OneWire.html" target="_blank">protocol driver</a> and <a href="http://milesburton.com/Dallas_Temperature_Control_Library" target="_blank">temperature conversion and packaging</a> respectively. Links and installation instructions can be found on the <a href="../download/tools-libraries/">3rd-part tools and libraries page</a>.</p>
<p></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/06/api-communications/" class="u-url">API communications now working</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/06/api-communications/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-06T12:12:05+01:00" itemprop="datePublished" title="2013-07-06 12:12">2013-07-06 12:12</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>A small sensor network now working, with two edge devices talking to a base station.</p>
<!--more-->

<p><img alt="Network" src="../images/citizen-sensing/network.jpg"></p>
<p>This step of the project accomplishes two things: is gets API networking mode working for the XBee radios, and makes sure the the interaction between software on the Arduinos and software running on the base station work too.</p>
<p>The data stream is simple enough: each Arduino counts up from 0 to 255 every 5s, passing the result up to the co-ordinator radio. A Processing program on the laptop collects the numbers and prints them. Naturally they become somewhat intertwined as their clocks aren't quite synchronised.</p>
<p>Actually this is enough to perform a simple radio survey to check transmission distance: we can move the radios away from the base station until they lose contact (nominally 100m for these 2mW radios, in reality probably substantially less), then move back into range, and then move one of the radios again to check that it meshes with the intermediate node in reaching back to the base station. This will also check that battery power works.</p>
<p><img alt="Meshing" src="../images/citizen-sensing/processing-xbee-api.png"></p>
<p>The software is quite straightforward, and the <a href="2013/07/03/xbee-arduino/">xbee-arduino library</a> handles all the low-level communications -- although it's very low-level, fine for the experienced programmer but probably all but mystifying to anyone not used to this kind of software. The corresponding Java xbee-api library is slightly more friendly, but <em>only</em> slightly: they probably both need wrapping into a framework that hides the radio nastiness.</p>
<p>I think the biggest hurdle for this sort of system is the data format -- or, more precisely, the need (or desire, at least) to to use C at one end and Processing/Java at the other, which means that the data on the wire is being described twice. A framework approach could use (for example) <a href="http://www.json.org/" target="_blank">JSON</a>, although there'd still be a need to make sure it was compactly encoded and transmitted.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/03/xbee-arduino/" class="u-url">The xbee-arduino library</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/03/xbee-arduino/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-03T08:30:22+01:00" itemprop="datePublished" title="2013-07-03 08:30">2013-07-03 08:30</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>A library for using XBee radios with Arduinos.</p>
<!--more-->

<p>The XBee radio operates in <a href="2013/07/01/xbee/" target="_blank">two modes</a>: transparent or text-based, and API or binary-based. The latter (API mode) is generally considered more suitable for computer-to-computer interactions, as it's faster and simpler for computers to manipulate. However, using an XBee in this mode requires additional software.</p>
<p>The <a href="https://code.google.com/p/xbee-arduino/" target="_blank">xbee-arduino library</a> provides Arduino functions to access the API mode functionality of the various XBee radio modules. The library is quite low-level, but does provide access to all the necessary functions like issuing AT commands to control the modem and sensing and receiving packets of data to other radios in the mesh network.</p>
<p>To use the library you download the latest version from the web page and unpack it into the <tt>libraries/</tt> directory of your Arduino IDE. You also need to make sure that the radios you use have the <a href="2013/07/02/xctu/" target="_blank">API function set installed using X-CTU</a>, as the library only makes sense for radios in API mode. You also have to set the "AP" parameter to 2 when writing the firmware.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/02/xctu/" class="u-url">XBee firmware management with X-CTU</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/02/xctu/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-02T09:00:34+01:00" itemprop="datePublished" title="2013-07-02 09:00">2013-07-02 09:00</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>Managing Digi's XBee radio modules requires using their X-CTU package to upload the correct firmware. In this post we explain how.</p>
<!--more-->

<p>This post is slightly depressing: not because it's on an unhappy topic, but because the effort and software needed to manage XBee radios is so complex to set up. In many ways this is just a function of the good design of the XBee: it's so minimal in terms of footprint and power consumption at run-time that it offloads a lot of work to external tools (and the user) at system build-time. But it's still a lot of work to get such a small piece of kit running.</p>
<p>X-CTU is intended to upload firmware to XBee radio modules. This is needed to change the firmware between router and co-ordinator of the Zigbee <a href="2013/07/02/mesh-network/" target="_blank">mesh network</a>, and between the different protocol variants that the XBee radios can support.</p>
<p><img alt="Xbee on USB" src="../images/citizen-sensing/2013-06-29-13.35.45.jpg"></p>
<p>One limitation of X-CTU is that it only works on Windows: if you're running Linux, X-CTU will run under <a href="http://www.winehq.org/" target="_blank">Wine</a>. You can download the latest X-CTU from <a href="http://www.digi.com/support/kbase/kbaseresultdetl?id=2125" target="_blank">Digi's X-CTU page</a>; alternatively, there's a version installed on the <a href="../download/virtual-machine/" target="_blank">Citizen Sensing VM</a>.</p>
<p>To use X-CTU you need to connect your XBee module to your computer. The easiest way to do this is using an XBee USB breakout board, which provides an XBee socket and a USB socket. Insert the radio into the board, plug in a USB cable, and plug the other end into a USB socket. The light on the breakout board will then come on (see photograph above).</p>
<p><img alt="X-CTU in operation" src="../images/citizen-sensing/xctu-connect.png"></p>
<p>You next need to start up X-CTU and tell it where the XBee is. It hangs off a Windows COM port, and X-CTU will typically find it automatically. You should then be able to press the "Test/Query" button, and X-CTU will interrogate the XBee and display a small window showing some information about it, as shown in the screenshot on the right: the details don't matter, but this shows that the XBee is talking to the computer properly.</p>
<p><img alt="X-CTU router firmware" src="../images/citizen-sensing/xctu-firmware-router.png"></p>
<p>Assuming everything is now working correctly, the next step is to decide what firmware to download to the radio. Click on the "Modem configuration" tab, and then click the "Read" button: this reads the firmware that's on the XBee at the moment, and puts the details into the window. Typically this results in a display like that shown on the left. The important things to notice are the two drop-down boxes labelled "Function Set" and "Version". The function set is the description of the firmware, in which case indicating that the XBee is running Zigbee router firmware that responds to AT commands (more on this below).</p>
<p><img alt="X-CTU co-ordinator firmware" src="../images/citizen-sensing/xctu-firmware-coordinator.png"></p>
<p>To download a new firmware, we then select the function set and version we want to use. Suppose we want to make this XBee into the mesh co-ordinator. We change the function set to "Zigbee Coordinator AT" (keeping with Zigbee and the AT command set) in  "Function set" the drop-down, then select the most recent version of this function set from the "Version" drop-down. (Versions are identified by hex numbers: the most recent in the screenshot right is "20A7", that being the highest hex number. Unfortunately X-CTU orders the numbers alphabetically, not in hex-numeric order.) Pressing "Write" will update the radio's firmware, and the radio is then ready for use as a co-ordinator.</p>
<p>If you look through the list of function sets, there will be quite a few options, including protocols other than Zigbee. These probably aren't worth too much exploration, but you'll also notice that there are Zigbee AT and API function sets corresponding to the <a href="2013/07/01/xbee/" target="_blank">two modes (transparent and API)</a> that the XBee can support. Be sure to select the correct one for your application.</p>
<p>That's it: the radio is now ready for use.
</p>
<h3>Advanced use: setting optional parameters</h3>
There's one more thing that X-CTU can be used for: it can set parameters to the firmware function set, and this is sometimes important when using the radios.
<p><img alt="X-CTU parameter setting" src="../images/citizen-sensing/xctu-parameter-setting.png"></p>
<p>When you've read the firmware from a radio, the main part of the X-CTU window contains a hierarchy of folders and cryptic values, for example "(4) PL - Power level". These are parameters that can be changed to modify the detailed behaviour of the radio. Some can also be set using AT commands. The example we used sets the radio's power level to 4. If you click on this, it will show a drop-down box giving other options. You might, for some applications, choose to reduce the radio power to 1 ("low") to save batteries. If you choose this and then write the firmware to the radio, the module will use this power setting.</p>
<p>In the example shown on the left, we're changing the AP parameter ("API enable") to 2, which is needed for the <a href="2013/07/03/xbee-arduino" target="_blank">xbee-arduino library</a> to work properly. If we now write the firmware (with the Zigbee co-ordinator API function set selected as shown), the radio will be ready for use.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/02/mesh-network/" class="u-url">Mesh networking</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/02/mesh-network/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-02T08:00:45+01:00" itemprop="datePublished" title="2013-07-02 08:00">2013-07-02 08:00</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>A mesh network is a way of setting up a communications system when there's no fixed infrastructure available. They're often used for communications in remote sites, and on sensor networks.</p>
<!--more-->

<p>If you've used wifi, you've used an <em>infrastructural</em> wireless network in which there is a dedicated router that talks to all the devices in its range (phones, tablets, laptops, wireless-enabled printers, ...) and connects them to the internet. The devices don't talk to each other directly: if they want to exchange information (to print a document, for example) they do <em>via</em> the router.</p>
<p>Another kind of infrastructural network is the cellular telephone service. All calls go through the cell towers: if you call your friend, and she happens to be standing next to you, your phone still talks to the nearest cell tower which then talks to her phone -- a round trip that might be a couple of kilometres! While this sounds a bit barmy, it simplifies the design of the network and the software needed to manage it, and is fine in situations where there is plenty of power and room for the infrastructure.</p>
<p>By contrast to these large-scale systems, XBees provide <a href="https://en.wikipedia.org/wiki/Mesh_networking" target="_blank"><em>mesh</em> networking</a> in which the devices co-operate to route traffic from the sensor motes (using <em>router</em> radios) to the base station (running a <em>co-ordinator</em> radio). As well as generating and receiving messages, nodes in the network also co-operate in moving other nodes' traffic. There is no infrastructure -- the nodes are both the users <em>and</em> the providers of the network -- which means a mesh can be deployed in areas without any "official" network coverage, or to provide functions (like low power) that the infrastructure that <em>is</em> available can't deliver. Each mesh network works on a particular network protocol, different to the ones used for wifi or cellular telephony.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/07/01/xbee/" class="u-url">XBee radios</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/07/01/xbee/" rel="bookmark">
            <time class="published dt-published" datetime="2013-07-01T18:23:15+01:00" itemprop="datePublished" title="2013-07-01 18:23">2013-07-01 18:23</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>The XBee is a series of small radio modules that implement the Zigbee protocol and work well with Arduinos.</p>
<!--more-->

<p><img alt="Xbees and an Arduino" src="../images/citizen-sensing/2013-07-01-18.12.32.jpg"></p>
<p>XBees are made by <a href="http://www.digi.com" target="_blank">Digi</a>. The range includes a number of <a href="http://digi.com/products/wireless-wired-embedded-solutions/zigbee-rf-modules/zigbee-mesh-module/" target="_blank">options</a>: you almost certainly want some variant of the Zigbee range. The Series 2 (S2) modules seem to offer good performance, low power, and a useful range of functions. There are several different antenna types and two different radio powers (2mW and 50mW): larger power provides more range (1km nominal as opposed to 100m) at the cost of twenty-five times the power consumption: best avoided unless really needed. A collection of XBee modules co-operate to form a mesh network that's quite robust against partial failure, which makes them great for use in the field.</p>
<p>To get XBees working with an Arduino you need several pieces of hardware and software:
</p>
<ul>
<li>Two or more radios (obvious, but surprisingly easy to only buy one...)</li>
    <li>One or more Arduinos</li>
    <li>One Arduino XBee shield for each radio-equipped Arduino</li>
    <li>One XBee USB breakout board</li>
    <li>The X-CTU firmware management software</li>
</ul>
There are also variations of Arduinos that take XBee modules directly, as well as other sensor mote systems that can work with them: they're not completely Arduino-specific.
<p>When buying radios, buy them all the same series: the different series aren't guaranteed to interwork (although they often do). In the photograph above there are two <em>different</em> XBees: one with a patch antenna and one with a whip antenna.</p>
<p>The Xbee shield fits on top of the Arduino. They're sold without a radio module.</p>
<p>The breakout board is used to connect an XBee to the USB port of a computer, allowing your network to be accessed from the desktop. This is useful for debugging and for data logging, unless you're also going to build a dedicated data logger.</p>
<p>The X-CTU software manages the firmware on the radio module. Because the radios are small and low-power, they don't have room for a sophisticated software stack, and so aren't programmed in the normal way. Instead you download a firmware providing exactly the functions you need. Each network is given an identifier (a <em>personal area network id</em> or <em>PAN</em>) so that several networks can co-exist in the same area without interfering with each other. Each network has exactly one co-ordinator, with the others being routers, Co-ordinator and router use different firmware: you nominate one of your radios as co-ordinator (which will typically live on the base station, or on the data logger) and use X-CTU to load co-ordinator firmware to it; the other radios get router firmware and are placed onto the sensor motes.</p>
<p>XBees actually have two communication modes you can choose between, by choosing different firmware. The simplest is the AT firmware. These provide simple, text-based communications between radios: what one Arduino writes as text comes out on the other. In this mode the XBee also responds to Hayes AT commands, a standard way of controlling a modem (which is what an XBee technically is): we'll explore these commands in another post. This function set -- router and co-ordinator -- sets up what might be called a <em>transparent</em> network, in the sense that it behaves just like a serial pipe. This makes it easy to get things up and running.Text-based interaction isn't great for computer-to-computer communications, however, not least because of the effort (and memory) needed to understand text-based protocols. For this reason, the XBee also supports API function sets that provide binary communications. These are better for computers, and faster when running, but require more programming and more intellectual effort to understand. We'll deal with API communications in another post too.</p>
<p>We'll deal with the details of using X-CTU <a href="2013/07/02/xctu/">in another post</a>, as well as explaining how to set up a simple network.</p>
<p></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/06/28/soldering/" class="u-url">First bit of soldering done</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/06/28/soldering/" rel="bookmark">
            <time class="published dt-published" datetime="2013-06-28T17:44:57+01:00" itemprop="datePublished" title="2013-06-28 17:44">2013-06-28 17:44</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>The first proto-shield has been assembled.</p>
<!--more-->

<p>The <a href="https://www.sparkfun.com/products/7914" target="_blank">SparkFun prototype shield</a> for the Arduino essentially lets you put a small custom circuit onto an Arduino shield.</p>
<p><img alt="Arduino prototyping shield" src="../images/citizen-sensing/2013-06-28-18.31.43.jpg"></p>
<p>The "bare" version has a small area for soldering-up in the middle of the shield. I decided to make a slightly more re-usable version with a small breadboard so I could experiment with the electronics without soldering.  The <a href="https://www.sparkfun.com/tutorials/181" target="_blank">assembly</a> is very easy, although the board is of course very cramped. The "helping hands"  were invaluable.</p>
<p>Several lessons learned: I need a finer bit for my soldering iron, a smaller pair of side-cutters for trimming the wires, and my soldering skills are truly appallingly rusty. The shield has a couple of places where it can take additional headers (for controlling the LEDs and using the spare button that's not being used for reset, and to bring the ICSP connectors through) which it would be useful to have.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/06/21/parts-arrive/" class="u-url">The parts arrive</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/06/21/parts-arrive/" rel="bookmark">
            <time class="published dt-published" datetime="2013-06-21T10:00:32+01:00" itemprop="datePublished" title="2013-06-21 10:00">2013-06-21 10:00</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>The parts have arrived for the ditch project.</p>
<!--more-->

<p>The first tranche of hardware came (in a small box) today:</p>
<p><img alt="Enough parts for four sensors and a base station" src="../images/citizen-sensing//2013-06-19-14.14.06.jpg"></p>
<p>There are parts here for four sensor packages and a base station. The sensor nodes have an Arduino, a 2mW XBee radio, and a digital temperature sensor. The base station has an XBee and a wired ethernet for connecting up to the internet. There are also some prototyping shields to simplify integration, a wall wart power supply for the base station, and some other goodies to support some other development.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="2013/06/20/parts-list/" class="u-url">Sensor mote initial parts list</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Simon Dobson
            </span></p>
            <p class="dateline">
            <a href="2013/06/20/parts-list/" rel="bookmark">
            <time class="published dt-published" datetime="2013-06-20T14:05:29+01:00" itemprop="datePublished" title="2013-06-20 14:05">2013-06-20 14:05</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p></p>
<p>The initial design for a sensor mote puts three temperature sensors together with an Arduino and short-range radio module.</p>
<!--more-->

<p>The following is the parts list for a single sensor mote:
</p>
<ul>
<li>Arduino Uno -- £18.50</li>
    <li>Arduino XBee shield -- £12.10</li>
    <li>Arduino Series 2 2mW XBee radio module -- £17.50</li>
    <li>Arduino prototype shield -- £10.40</li>
    <li>Mini-breadboard -- £2.00</li>
    <li>3 x DS18B20 one-wire digital temperature sensor -- £11.70</li>
    <li>Battery holder -- £1.20</li>
    <li>Enclosure (waterproof, resealable food box) -- £3.50</li>
</ul>
A total of £76.90 (+ VAT) per sensor, not including assorted wires and resistors.
<p>[UPDATED 11Jul2013: added cost of enclosure]</p>
<p></p>
</div>
    </div>
    </article>
</div>
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-12.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-10.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content--><footer id="footer"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License CC-BY-NC-SA-4.0" style="border-width:0" src="../images/cc-by-nc-sa-4.0.png"></a>

            
        </footer>
</div>
</div>

        <script src="../assets/js/all-nocdn.js"></script><script src="https://polyfill.io/v3/polyfill.js?features=Intl.RelativeTimeFormat.%7Elocale.en"></script><script src="../assets/js/luxon.min.js"></script><!-- fancy dates --><script>
        luxon.Settings.defaultLocale = "en";
        fancydates(2, {"preset": false, "format": "yyyy-MM-dd HH:mm"});
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
